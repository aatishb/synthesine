---
layout: livecode
title: Voice
category: synthesis
blurb: |
  This example implements the [Kelly-Lochbaum model](https://ccrma.stanford.edu/~jos/pasp/Singing_Kelly_Lochbaum_Vocal_Tract.html) to simulate vowel sounds.

  This model was first implemented by John Kelly and Carol Lochbaum in 1962. It was used to create the singing voice of the HAL 9000 computer in 2001: A Space Odyssey.

  It models the vocal tract as an audio filter, which consistes of a series of 44 cylindrical segments, each with a specific cross-sectional area. The filter is fed in a glottal wave (which represents the sound made by the vocal chords), and a list of 44 numbers which denote the cross-sectional area of the vocal tract.

---
// vowel measurements from https://www.sciencedirect.com/science/article/pii/S0095447098900766
let vowels = [
[0.33,0.3,0.36,0.33,0.64,0.46,1.7,3.14,2.89,2.45,2.87,3.71,3.77,3.92,4.5,4.44,4.47,4.71,4.44,4.15,4.07,3.51,2.98,2.1,1.69,1.44,1.13,0.72,0.39,0.33,0.21,0.1,0.08,0.27,0.21,0.26,0.45,0.21,0.43,0.77,1.69,2.06,2.01,1.58]
,[0.2,0.18,0.16,0.19,0.11,0.67,1.7,1.64,1.45,0.97,0.84,1.9,2.35,2.97,3.21,3.37,3.33,3.61,3.91,3.82,3.86,3.47,3,2.65,2.41,2.07,1.85,1.82,1.47,1.49,1.23,0.91,0.79,0.88,1.14,1.48,1.75,1.95,1.57,2.09,1.86,1.6,1.35,1.18]
,[0.23,0.13,0.14,0.19,0.04,0.26,1.08,1.26,1.21,0.96,0.72,0.74,0.91,1.64,1.91,2.2,2.62,2.77,2.98,3,2.83,2.84,2.86,2.44,2.15,2.1,1.84,1.77,1.84,1.72,1.45,1.37,1.36,1.43,1.72,2.08,2.36,2.66,2.38,1.95,2.68,2.61,2.19,1.6]
,[0.23,0.26,0.27,0.17,0.15,0.14,0.59,1.31,1.54,1.06,0.93,0.67,1.98,2.25,2.08,1.9,2.35,2.92,3.33,3.76,3.8,3.69,3.87,3.73,3.23,3.24,3.3,3.21,3.21,3.24,3.28,3.62,3.86,3.86,4.15,4.52,4.59,4.77,4.36,4.36,4.3,4.55,4.3,3.94]
,[0.33,0.28,0.23,0.15,0.17,0.33,0.39,1.02,1.22,1.14,0.82,0.76,0.66,0.8,0.72,0.66,1.08,0.91,1.09,1.06,1.09,1.17,1.39,1.55,1.89,2.17,2.46,2.65,3.13,3.81,4.3,4.57,4.94,5.58,5.79,5.51,5.49,4.69,4.5,3.21,2.79,2.11,1.98,1.17]
,[0.45,0.2,0.26,0.21,0.32,0.3,0.33,1.05,1.12,0.85,0.63,0.39,0.26,0.28,0.23,0.32,0.29,0.28,0.4,0.66,1.2,1.05,1.62,2.09,2.56,2.78,2.86,3.02,3.75,4.6,5.09,6.02,6.55,6.29,6.27,5.94,5.28,4.7,3.87,4.13,4.25,4.27,4.69,5.03]
,[0.61,0.28,0.19,0.1,0.07,0.3,0.18,1.13,1.42,1.21,0.69,0.51,0.43,0.66,0.57,0.32,0.43,0.45,0.53,0.6,0.77,0.65,0.58,0.94,2.02,2.5,2.41,2.62,3.29,4.34,4.78,5.24,6.07,7.08,6.81,6.2,5.89,5.04,4.29,2.49,1.84,1.33,1.19,0.88]
,[0.18,0.17,0.23,0.28,0.59,1.46,1.6,1.11,0.82,1.01,2.72,2.71,1.96,1.92,1.7,1.66,1.52,1.28,1.44,1.28,0.89,1.25,1.38,1.09,0.71,0.46,0.39,0.32,0.57,1.06,1.38,2.29,2.99,3.74,4.39,5.38,7.25,7,4.57,2.75,1.48,0.68,0.39,0.14]
,[0.32,0.39,0.39,0.43,0.56,1.46,2.2,2.06,1.58,1.11,1.11,1.26,1.3,0.98,0.93,0.83,0.61,0.97,0.75,0.93,0.53,0.65,0.95,0.99,1.07,1.39,1.47,1.79,2.34,2.68,3.36,3.98,4.74,5.48,5.69,5.57,4.99,4.48,3.07,1.67,1.13,0.64,0.15,0.22]
,[0.4,0.36,0.29,0.44,0.69,2.15,3,2.72,2.15,2.48,4.95,5.91,5.49,5.05,4.6,4.41,3.77,3.39,3.18,3.29,3.24,2.33,2.08,2.04,1.42,0.62,0.18,0.17,0.22,0.25,0.46,0.71,0.75,1.33,2.23,2.45,3.16,5.16,4.92,2.73,1.21,0.79,0.42,0.86]
];

let filter;
let vowel = 0; // index that keeps track of the vowel being played
let freq = 330;
let pastVowel = vowel;

function setup() {
  slider('vowel', 0, 9, 1)
  slider('freq', 220, 440, 1)
  filter = vocalTract(vowels[vowel]);
}

function loop() {


  // if slider moves, reset the filter with the new vowel data
  if (pastVowel !== vowel) {
    filter.set(vowels[vowel]);
    pastVowel = vowel;
  }

  return glottalWave(freq, sinWave(1).mult(20)).apply(filter).mult(0.2);
}